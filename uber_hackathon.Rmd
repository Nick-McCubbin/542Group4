---
title: "Uber Hackaton"
author: "You"
date: "`r Sys.Date()`"
output: html_document
---

```{r message=FALSE}
library(caret)
library(lubridate)
library(gbm)

```

## Data dictionary

* `pickup_dt`: Time period of the observations.
* `borough`: NYC's borough.
* `pickups`: Number of pickups for the period.
* `spd`: Wind speed in miles/hour.
* `vsb`: Visibility in Miles to nearest tenth.
* `temp`: temperature in Fahrenheit.
* `dewp`: Dew point in Fahrenheit.
* `slp`: Sea level pressure.
* `pcp01`: 1-hour liquid precipitation.
* `pcp06`: 6-hour liquid precipitation.
* `pcp24`: 24-hour liquid precipitation.
* `sd`: Snow depth in inches.
* `hday`: Being a holiday (Y) or not (N).

```{r}
# Load in data
load("UBERHACKATHON.RData")

# Convert pickup time to date object
TRAIN$pickup_dt <- ymd_hms(TRAIN$pickup_dt)
KAGGLE$pickup_dt <- ymd_hms(KAGGLE$pickup_dt)

# Extract out potentially useful date information
# hour of day
TRAIN$hour <- factor(hour(TRAIN$pickup_dt))
KAGGLE$hour <- factor(hour(KAGGLE$pickup_dt))

# month
TRAIN$month <- month(TRAIN$pickup_dt, label = TRUE)
KAGGLE$month <- month(KAGGLE$pickup_dt, label = TRUE)

# day of week
TRAIN$wday <- wday(TRAIN$pickup_dt, label = TRUE)
KAGGLE$wday <- wday(KAGGLE$pickup_dt, label = TRUE)

# Drop date column, no longer useful
TRAIN$pickup_dt <- NULL
KAGGLE$pickup_dt <- NULL

# Remove ID column from training data
TRAIN$IDno <- NULL
```

* Build predictive models to predict `logpickups`
* Create predictions 

```{r}
dim(TRAIN)
head(TRAIN, 3)

fit <- gbm(
  logpickups ~ .,
  data = TRAIN,
  shrinkage = 0.01,
  interaction.depth = 20,
  n.minobsinnode = 3,
  n.trees = 3750)
```


```{r}
mean(y_pred)
```

Example of how to make a submission file:

```{r}
# Change YOUR_FIT_MODEL to your model's name
y_pred <- predict(fit, newdata = KAGGLE)
sd(y_pred)

predictions <- data.frame(
  IDno = KAGGLE$IDno,
  logpickups = y_pred
)

# Change FILENAME.csv to a nice name to keep organized
# Don't lose good predictions because of poor naming
write.csv(
  predictions,
  file = "GBM40.csv",
  row.names = FALSE
)
```
